import{_ as O,u as me}from"./index.500a2a7a.js";/* empty css                *//* empty css                *//* empty css              *//* empty css               *//* empty css                *//* empty css              *//* empty css               *//* empty css               */import{d as W,e as b,r as q,aL as M,C as I,D as L,aI as t,aH as s,G as _,E as K,bB as _e,aR as A,bC as fe,bD as Ce,c as G,z as ve,u as F,aE as Fe,aF as Be,aN as f,b2 as ge,b1 as ye,b4 as De,bE as Ee,bA as he,bm as be,bn as Ae,b7 as we,bF as ke,b8 as xe,aW as Ve,bG as Ne,by as Ue,b9 as Se,ba as Ie}from"./arco.f893a4fd.js";import{f as Re}from"./vue.de90413b.js";import{u as $e}from"./loading.c2b41a1f.js";/* empty css                *//* empty css               */import{i as qe}from"./file-handle.8839f387.js";import{a as Le,c as He,d as Te,e as Pe}from"./citys.7406df18.js";import{S as B,D as z}from"./enums.4b6db02f.js";import{g as ze}from"./tools.7a257584.js";import"./chart.3eba121e.js";import"./index.ec9a9efd.js";const Me={class:"uploader-container"},je={class:"arco-upload-list-item o"},Ge={key:0,class:"arco-upload-list-picture"},Oe=["src"],We={key:1,class:"arco-upload-picture-card"},Ke={class:"arco-upload-picture-card-text"},Ze={class:"arco-upload-tip"},Je={class:"custom-arco-upload-icon"},Qe=W({__name:"index",emits:["updateImgUrl"],setup(w,{expose:k,emit:x}){const D=b(),d=b(),p=q({limit:1,size:200,action:"/",multiple:!1,draggable:!0,autoUpload:!1,imagePreview:!0,accept:"image/png, image/jpeg",type:"picture-card",proress:0}),E=m=>new Promise(C=>{m.size>p.size*1024?(A.error(`\u4E0A\u4F20\u7684\u6821\u5FBD\u6700\u5927${p.size}KB`),C(!1)):C(m)}),R=()=>new Promise(m=>{m(!0)}),H=m=>{d.value=m.fileItem;const C=D.value.$el,n=C.querySelector(".arco-upload-list-picture"),r=C.querySelector(".arco-upload-type-picture-card");return n.classList.add("arco-upload-hide"),r.classList.remove("arco-upload-hide"),qe(d.value.file).then(N=>{p.proress=1,x("updateImgUrl",N),A.success("\u4E0A\u4F20\u6210\u529F\uFF01")}),{}},V=m=>{m.stopPropagation();const C=D.value;R(),C.abort(d.value),d.value=void 0,p.proress=0,x("updateImgUrl","")};return k({setBackImg:m=>{d.value={url:m,name:"",uid:Date.now().toString()}}}),(m,C)=>{const n=M("icon-close-circle-fill"),r=fe,N=Ce,g=M("icon-camera");return I(),L("div",Me,[t(N,{ref_key:"oUpload",ref:D,class:"refine-uploader","file-list":d.value?[d.value]:[],"show-file-list":!0,"list-type":p.type,accept:p.accept,draggable:p.draggable,"image-preview":p.imagePreview,"auto-upload":p.autoUpload,limit:p.limit,multiple:p.multiple,"custom-request":H,onBeforeUpload:E,onBeforeRemove:R},{"upload-button":s(()=>[_("div",je,[d.value&&d.value.url?(I(),L("div",Ge,[_("img",{src:d.value.url},null,8,Oe),_("div",{class:"arco-upload-list-picture-mask o",onClick:V},[t(n)]),t(r,{class:K(["custom-upload-progress",{"op-0 visi-hide":p.proress==1}]),type:"circle",percent:p.proress,"stroke-width":4,"track-color":"#5E94F6",color:"var(--color-bg-1)"},null,8,["class","percent"])])):(I(),L("div",We,[_("div",Ke,[_("div",Ze,[_e(m.$slots,"uploader-tips",{},void 0,!0)])])]))])]),_:3},8,["file-list","list-type","accept","draggable","image-preview","auto-upload","limit","multiple"]),_("div",Je,[t(g,{"stroke-width":4,style:{fontSize:"20px",color:"#417FF2"}})])])}}});const Xe=O(Qe,[["__scopeId","data-v-6c74ba2e"]]),j=w=>(Se("data-v-03f64de7"),w=w(),Ie(),w),Ye={class:"add-school"},eo={class:"custom-form-wrap"},oo=j(()=>_("div",{class:"title-text"},"\u6821\u5FBD",-1)),ao=j(()=>_("div",{class:"title-tips"},"\u70B9\u51FB\u6216\u62D6\u62FD\u4E0A\u4F20",-1)),to=f("\u5C0F\u5B66"),uo=f("\u521D\u4E2D"),lo=f("\u9AD8\u4E2D"),so=f("\u5927\u5B66"),io=f(" \xA0\xA0 "),ro=f(" \xA0\xA0 "),no=f("\u662F"),co=f("\u5426"),po={class:"bottom-btns"},mo=f("\u8FD4\u56DE"),_o=f("\u91CD\u7F6E"),fo=f(" \u63D0\u4EA4 "),Co=f(" \u4FE1\u606F\u586B\u5199\u786E\u8BA4 "),vo=j(()=>_("div",{class:"confirm-text"}," \u4EE5\u4E0B\u4FE1\u606F\u975E\u5E38\u91CD\u8981\uFF0C\u8BF7\u518D\u6B21\u786E\u8BA4\u4FE1\u606F\u662F\u5426\u586B\u5199\u65E0\u8BEF ",-1)),Fo={class:"confirm-table"},Bo=W({__name:"add",setup(w){const k=Re(),x=b(),D=b(),d=b(),p=me(),E=b(!1),R=["S","M","H","U"],{loading:H,setLoading:V}=$e(),e=q({id:"",name:"",identifier:"",badgeToken:"",type:"",typeList:[],slogan:"",provinceCode:"",provinceName:"",cityCode:"",cityName:"",areaCode:"",areaName:"",address:"",phone:"",verificationCode:"",ascriptionCity:0}),m=G(()=>e.id?"\u786E\u8BA4\u4FEE\u6539":"\u786E\u8BA4\u6DFB\u52A0"),C=G(()=>{let a="";return e.typeList.forEach(o=>{a+=`${B[o]}`}),a}),n=q({provinceData:[],cityData:[],areaData:[]}),r=q({count:60,message:"\u83B7\u53D6\u9A8C\u8BC1\u7801",timer:void 0}),N=a=>{e.badgeToken=a.badgeToken},g=async(a,o)=>{const{succ:u,data:i}=await Le({code:o,type:a});u&&(i==null||i.forEach(c=>{Object.entries(c).forEach(U=>{const[y,v]=U;c.label=v,c.value=y})}),a==="province"&&(n.provinceData=i),a==="city"&&(n.cityData=i),a==="area"&&(n.areaData=i))},Z=async a=>{let[o,u]=[!1,""];const{id:i}=e,c={id:i,name:e.name,type:e.type,phone:e.phone,address:e.address,slogan:e.slogan,cityCode:e.cityCode,cityName:e.cityName,areaCode:e.areaCode,areaName:e.areaName,identifier:e.identifier,badgeToken:e.badgeToken,provinceCode:e.provinceCode,provinceName:e.provinceName,ascriptionCity:e.ascriptionCity,verificationCode:e.verificationCode};i?(Reflect.deleteProperty(c,"verificationCode"),{succ:o,msg:u}=await Te(c)):(Reflect.deleteProperty(c,"id"),{succ:o,msg:u}=await Pe(c)),o?setTimeout(()=>{a(!0),k.replace({name:"Schoolmgmt"})},300):(a(!1),A.error(u)),V(!1)},J=async()=>{const{phone:a}=e,{getCode:o}=p;return!!await o({phone:a})},Q=async()=>r.timer?!1:e.phone?await J()?(r.message=`${String(r.count)} s`,r.timer=window.setInterval(()=>{r.count-=1,r.message=`${String(r.count)} s`,r.count===1&&(clearInterval(r.timer),r.count=60,r.timer=void 0,r.message="\u83B7\u53D6\u9A8C\u8BC1\u7801")},1e3),!0):!1:(A.warning("\u8BF7\u5148\u586B\u5199\u624B\u673A\u53F7\u7801"),!1),X=a=>{a.includes(B.\u5927\u5B66)&&(a[0]===B.\u5927\u5B66?a.shift():a=[B.\u5927\u5B66]);const o=R.filter(u=>a.some(i=>u===i)).join("");o==="SH"&&A.warning({duration:3e3,content:"\u5B66\u6821\u7C7B\u578B\u7EC4\u5408\u4E0D\u80FD\u4E3A\u201C\u5C0F\u5B66\uFF0C\u9AD8\u4E2D\u201D"}),e.type=o,e.typeList=a,console.log(e.typeList,e.type)},Y=a=>{var o;e.cityCode="",e.areaCode="",e.cityName="",e.areaName="",a?(e.provinceCode=a,e.provinceName=(o=n.provinceData.find(u=>u.value===a))==null?void 0:o.label,g("city",a)):(n.cityData=[],n.areaData=[],e.provinceCode="",e.provinceName="")},ee=a=>{var o;e.areaCode="",e.areaName="",a?(e.cityCode=a,e.cityName=(o=n.cityData.find(u=>u.value===a))==null?void 0:o.label,g("area",a)):(n.areaData=[],e.cityCode="",e.cityName="")},oe=a=>{var o;a?(e.areaCode=a,e.areaName=(o=n.areaData.find(u=>u.value===a))==null?void 0:o.label):(e.areaCode="",e.areaName="")},ae=()=>{clearInterval(r.timer),d.value.resetFields(),e.type="",e.provinceCode="",e.provinceName="",e.cityCode="",e.cityName="",e.areaCode="",e.areaName="",n.cityData=[],n.areaData=[]},te=()=>{clearInterval(r.timer),k.back()},ue=a=>{const{provinceName:o,cityName:u,provinceCode:i,cityCode:c,areaName:U,areaCode:y,badgeToken:v,type:$}=a,T=d.value;Object.keys(a).forEach(h=>{const S=a[h];T.setFields({[h]:{value:S}})}),e.provinceName=o,e.provinceCode=i,e.cityName=u,e.cityCode=c,e.areaName=U,e.areaCode=y,e.type=$,e.badgeToken=v,e.typeList=$.split("");const P=D.value;if(v){const h=ze(v);P.setBackImg(h)}},le=async()=>{const{succ:a,data:o,msg:u}=await He({schoolId:e.id});a?(await g("city",o.provinceCode),await g("area",o.cityCode),ue(o)):A.error(u)},se=()=>{V(!0),d.value.validate(o=>{var u,i,c;o||(x.value=[{label:"\u5B66\u6821\u540D\u79F0",value:(u=e.name)!=null?u:"--"},{label:"\u5B66\u6821\u7C7B\u522B",value:(i=C.value)!=null?i:"--"},{label:"\u6240\u5C5E\u533A\u57DF",value:`${e.provinceName}-${e.cityName}-${e.areaName}`},{label:"\u5E02\u76F4\u5C5E\u5B66\u6821",value:(c=z[e.ascriptionCity])!=null?c:"--"}],E.value=!0),V(!1)})},ie=a=>{Z(a)},re=()=>(E.value=!1,!0);return ve(()=>{g("province");const{query:{schoolId:a}}=k.currentRoute.value;a&&(e.id=a,le())}),(a,o)=>{const u=ge,i=ye,c=De,U=Ee,y=he,v=be,$=Ae,T=we,P=ke,h=xe,S=Ve,ne=M("icon-info-circle-fill"),ce=Ne,de=Ue;return I(),L("div",Ye,[_("div",eo,[t(h,{ref_key:"formRef",ref:d,model:e,class:"custom-form"},{default:s(()=>[t(u,{label:"\u5B66\u6821\u6821\u5FBD",class:"flex-h-center"},{default:s(()=>[t(Xe,{ref_key:"uploaderRef",ref:D,style:{width:"165px"},onUpdateImgUrl:N},{"uploader-tips":s(()=>[oo,ao]),_:1},512)]),_:1}),t(u,{field:"name",label:"\u5B66\u6821\u540D\u79F0",rules:[{required:!0,message:"\u5B66\u6821\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}]},{default:s(()=>[t(i,{modelValue:e.name,"onUpdate:modelValue":o[0]||(o[0]=l=>e.name=l),"max-length":20,"allow-clear":"","show-word-limit":"",placeholder:"\u8BF7\u8F93\u5165\u5B66\u6821\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(u,{field:"typeList",label:"\u5B66\u6821\u7C7B\u522B",rules:[{required:!0,message:"\u5B66\u6821\u7C7B\u522B\u4E0D\u80FD\u4E3A\u7A7A"},{validator:(l,pe)=>{(String(l)==="S,H"||String(l)==="H,S")&&pe("\u5B66\u6821\u7C7B\u578B\u7EC4\u5408\u4E0D\u80FD\u4E3A\u201C\u5C0F\u5B66\uFF0C\u9AD8\u4E2D\u201D")}}]},{default:s(()=>[t(U,{modelValue:e.typeList,"onUpdate:modelValue":o[1]||(o[1]=l=>e.typeList=l),onChange:X},{default:s(()=>[t(c,{value:F(B).\u5C0F\u5B66},{default:s(()=>[to]),_:1},8,["value"]),t(c,{value:F(B).\u521D\u4E2D},{default:s(()=>[uo]),_:1},8,["value"]),t(c,{value:F(B).\u9AD8\u4E2D},{default:s(()=>[lo]),_:1},8,["value"]),t(c,{value:F(B).\u5927\u5B66},{default:s(()=>[so]),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1},8,["rules"]),t(u,{field:"name",label:"\u6240\u5C5E\u5730\u57DF",rules:[{required:!0,message:"\u5B66\u6821\u5730\u5740\u4E0D\u80FD\u4E3A\u7A7A"}]},{default:s(()=>[t(y,{modelValue:e.provinceCode,"onUpdate:modelValue":o[2]||(o[2]=l=>e.provinceCode=l),"allow-clear":"",options:n.provinceData,placeholder:"\u8BF7\u9009\u62E9\u7701",onChange:Y},null,8,["modelValue","options"]),io,t(y,{modelValue:e.cityCode,"onUpdate:modelValue":o[3]||(o[3]=l=>e.cityCode=l),"allow-clear":"",options:n.cityData,placeholder:"\u8BF7\u9009\u62E9\u5E02",onChange:ee},null,8,["modelValue","options"]),ro,t(y,{modelValue:e.areaCode,"onUpdate:modelValue":o[4]||(o[4]=l=>e.areaCode=l),options:n.areaData,placeholder:"\u8BF7\u9009\u62E9\u53BF/\u533A","allow-clear":"",onChange:oe},null,8,["modelValue","options"])]),_:1}),t(u,{field:"identifier",label:"\u5B66\u6821\u7F16\u7801",rules:[{required:!1,match:/^[a-zA-Z0-9]+$/,message:"\u5B66\u6821\u7F16\u7801\u53EA\u80FD\u4E3A\u5B57\u6BCD\u6216\u6570\u5B57"}]},{default:s(()=>[t(i,{modelValue:e.identifier,"onUpdate:modelValue":o[5]||(o[5]=l=>e.identifier=l),placeholder:"\u8BF7\u8F93\u5165\u5B66\u6821\u7F16\u7801","max-length":15,"allow-clear":"","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(u,{field:"slogan",label:"\u5B66\u6821\u6821\u8BAD"},{default:s(()=>[t(i,{modelValue:e.slogan,"onUpdate:modelValue":o[6]||(o[6]=l=>e.slogan=l),placeholder:"\u8BF7\u5728\u6B64\u8F93\u5165\u6821\u8BAD"},null,8,["modelValue"])]),_:1}),t(u,{field:"ascriptionCity",label:"\u662F\u5426\u5E02\u76F4\u5C5E\u5B66\u6821",rules:[{required:!0,message:"\u662F\u5426\u76F4\u5C5E\u9009\u62E9\u4E0D\u80FD\u4E3A\u7A7A"}]},{default:s(()=>[t($,{modelValue:e.ascriptionCity,"onUpdate:modelValue":o[7]||(o[7]=l=>e.ascriptionCity=l)},{default:s(()=>[t(v,{value:F(z).\u662F},{default:s(()=>[no]),_:1},8,["value"]),t(v,{value:F(z).\u4E0D\u662F},{default:s(()=>[co]),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1}),t(u,{field:"phone",label:"\u7BA1\u7406\u5458\u8054\u7CFB\u65B9\u5F0F",disabled:!!e.id,rules:[{required:!0,match:/^(?:(?:\+|00)86)?1[3-9]\d{9}$/,message:"\u624B\u673A\u53F7\u7801\u683C\u5F0F\u4E0D\u6B63\u786E"}]},{default:s(()=>[t(i,{modelValue:e.phone,"onUpdate:modelValue":o[8]||(o[8]=l=>e.phone=l),placeholder:"\u8BF7\u8F93\u5165\u7BA1\u7406\u5458\u8054\u7CFB\u65B9\u5F0F\uFF0C\u53EF\u4F5C\u4E3A\u4F53\u6D4B\u5E73\u53F0\u767B\u5F55\u8D26\u53F7"},null,8,["modelValue"])]),_:1},8,["disabled","rules"]),e.id?Be("",!0):(I(),Fe(u,{key:0,field:"verificationCode",label:"\u9A8C\u8BC1\u7801",rules:[{required:!0,match:/\d{6}/,message:"\u9A8C\u8BC1\u7801\u5FC5\u987B\u4E3A6\u4F4D\u957F\u5EA6\u7684\u6570\u5B57"}]},{default:s(()=>[t(T,{modelValue:e.verificationCode,"onUpdate:modelValue":o[9]||(o[9]=l=>e.verificationCode=l),placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801","search-button":"","allow-clear":"","button-text":r.message,class:K(["valicode-wrap",{disabled:r.timer}]),onSearch:Q},null,8,["modelValue","button-text","class"])]),_:1})),t(u,{field:"address",label:"\u8BE6\u7EC6\u5730\u5740"},{default:s(()=>[t(P,{modelValue:e.address,"onUpdate:modelValue":o[10]||(o[10]=l=>e.address=l),placeholder:"\u8BF7\u8F93\u5165\u8BE6\u7EC6\u5730\u5740\uFF0C\u6700\u591A\u4E0D\u8D85\u8FC7200\u5B57\u3002","allow-clear":"","auto-size":{maxRows:4,minRows:3},"max-length":200,"show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_("div",po,[t(S,{class:"mr15",onClick:te},{default:s(()=>[mo]),_:1}),t(S,{class:"mr15",onClick:ae},{default:s(()=>[_o]),_:1}),t(S,{type:"primary",loading:F(H),onClick:se},{default:s(()=>[fo]),_:1},8,["loading"])]),t(de,{visible:E.value,"onUpdate:visible":o[11]||(o[11]=l=>E.value=l),simple:"",width:460,class:"custom-smiple-model","title-align":"start","unmount-on-close":"",closable:!1,"ok-text":F(m),"cancel-text":"\u8FD4\u56DE\u4FEE\u6539",onBeforeOk:ie,onBeforeCancel:re},{title:s(()=>[t(ne),Co]),default:s(()=>[vo,_("div",Fo,[t(ce,{column:1,"label-style":{color:"#4E5969",fontWeight:400,background:"var(--color-bg-1)"},data:x.value,bordered:""},null,8,["label-style","data"])])]),_:1},8,["visible","ok-text"])])}}});const To=O(Bo,[["__scopeId","data-v-03f64de7"]]);export{To as default};
