import{_ as X}from"./index.500a2a7a.js";/* empty css              *//* empty css               *//* empty css              *//* empty css               *//* empty css               *//* empty css                *//* empty css                *//* empty css                *//* empty css              *//* empty css               */import{d as Y,r as G,e as w,z as Z,C as D,D as L,aI as s,aH as u,aN as B,aO as T,aE as R,bK as ee,b2 as ae,bQ as _e,bR as fe,b1 as ue,aW as oe,bq as Fe,b8 as se,aL as ge,G as M,u as C,bH as j,aF as Be,aR as k,bm as Ee,bn as ve,aV as he,bS as De,bT as Ce,bU as be}from"./arco.f893a4fd.js";import{a as ke}from"./index.ec9a9efd.js";import{f as ye}from"./vue.de90413b.js";import{u as Ve}from"./loading.c2b41a1f.js";import{b as K,a as Re,c as Ae,d as we,e as Le,f as Te}from"./tests.0975a803.js";import{P as Ne,b as O,M as Q,E as W,c as J}from"./enums.4b6db02f.js";/* empty css                *//* empty css               *//* empty css               */import"./chart.3eba121e.js";const xe={class:"booking-container"},Ue={key:1},Se={key:1},qe={key:1},Ie={key:1},$e=B("\u6DFB\u52A0"),He=B("\u5220\u9664"),Pe=Y({__name:"booking",setup(te){const A=G({bookingRange:[]}),b=w([{title:"\u5E8F\u53F7",width:60,align:"center",slotName:"index"},{title:"\u9884\u7EA6\u65E5\u671F",dataIndex:"date",slotName:"date",align:"center"},{title:"\u65F6\u95F4\u8303\u56F4",dataIndex:"range",slotName:"range",width:220,align:"center"},{title:"\u4F53\u6D4B\u5730\u70B9",dataIndex:"address",slotName:"address",width:120,align:"center"},{title:"\u4EBA\u6570\u9650\u5236",dataIndex:"num",slotName:"num",width:120,align:"center"},{title:"\u64CD\u4F5C",dataIndex:"option",slotName:"option",align:"center"}]),y=w([]),r=G({id:99999,range:[],date:"",address:"",num:"",isEdit:!0}),N=()=>{const U=y.value.length,h={...r,isEdit:!1};y.value.splice(U-1,0,h),r.num="",r.range=[],r.date="",r.address="",console.log(y.value)};return Z(()=>{y.value.push(r)}),(U,h)=>{const $=ee,a=ae,H=_e,P=fe,S=ue,q=oe,I=Fe,x=se;return D(),L("div",xe,[s(x,{ref:"formRef",layout:"vertical",model:A,class:"custom-form"},{default:u(()=>[s(a,{field:"typeList",label:"\u9884\u7EA6\u8D77\u6B62\u65F6\u95F4",rules:[{required:!0,message:"\u9884\u7EA6\u8D77\u6B62\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A"}]},{default:u(()=>[s($,{modelValue:A.bookingRange,"onUpdate:modelValue":h[0]||(h[0]=_=>A.bookingRange=_)},null,8,["modelValue"])]),_:1}),s(a,{field:"booking",label:"\u9884\u7EA6\u4F53\u6D4B\u5185\u5BB9"},{default:u(()=>[s(I,{size:"mini",data:y.value,columns:b.value,pagination:!1,style:{width:"100%"},bordered:{wrapper:!0,cell:!0}},{index:u(({rowIndex:_})=>[B(T(_+1),1)]),date:u(({record:_})=>[_.isEdit?(D(),R(H,{key:0,modelValue:r.date,"onUpdate:modelValue":h[1]||(h[1]=V=>r.date=V),size:"mini"},null,8,["modelValue"])):(D(),L("span",Ue,T(_.date),1))]),range:u(({record:_})=>[_.isEdit?(D(),R(P,{key:0,modelValue:r.range,"onUpdate:modelValue":h[2]||(h[2]=V=>r.range=V),size:"mini",format:"HH:mm",type:"time-range"},null,8,["modelValue"])):(D(),L("span",Se,T(_.range.join("-")),1))]),address:u(({record:_})=>[_.isEdit?(D(),R(S,{key:0,modelValue:r.address,"onUpdate:modelValue":h[3]||(h[3]=V=>r.address=V),size:"mini"},null,8,["modelValue"])):(D(),L("span",qe,T(_.address),1))]),num:u(({record:_})=>[_.isEdit?(D(),R(S,{key:0,modelValue:r.num,"onUpdate:modelValue":h[4]||(h[4]=V=>r.num=V),size:"mini"},null,8,["modelValue"])):(D(),L("span",Ie,T(_.num),1))]),option:u(({record:_})=>[_.isEdit?(D(),R(q,{key:0,size:"mini",type:"text",onClick:N},{default:u(()=>[$e]),_:1})):(D(),R(q,{key:1,size:"mini",type:"text"},{default:u(()=>[He]),_:1}))]),_:1},8,["data","columns"])]),_:1})]),_:1},8,["model"])])}}});const ze=X(Pe,[["__scopeId","data-v-8a31d477"]]),Me={class:"add-test"},Ge={class:"custom-form-wrap"},je=B("\u56FD\u6807\u4F53\u6D4B"),Ke=B(" \u5F00\u542F "),Oe=B(" \u5173\u95ED "),Qe=B("\u6700\u65B0\u6210\u7EE9"),We=B("\u6700\u597D\u6210\u7EE9"),Je=B("\u5141\u8BB8"),Xe=B("\u4E0D\u5141\u8BB8"),Ye=B(" \u5F00\u542F "),Ze=B(" \u5173\u95ED "),ea=B(" \u5F00\u542F\u65F6\uFF0C\u4F53\u6D4B\u5165\u573A\u68C0\u5F55\u540E\u5B66\u751F\u540E\u4F53\u6D4B\u6210\u7EE9\u540C\u6B65\u5230\u5E73\u53F0\uFF1B\u672A\u5F00\u542F\uFF0C\u4F53\u6D4B\u5165\u573A\u65E0\u987B\u68C0\u5F55\u5373\u53EF\u540C\u6B65\u4F53\u6D4B\u6210\u7EE9\u5230\u5E73\u53F0 "),aa=B(" \u5F00\u542F "),ua=B(" \u5173\u95ED "),oa={key:1},sa={class:"bottom-btns"},ta=B("\u786E\u5B9A"),la=B("\u91CD\u7F6E"),na=B("\u8FD4\u56DE"),da=Y({__name:"add",setup(te){const A=w(0),b=w(""),y=w(!1),r=ye(),N=w(),{loading:U,setLoading:h}=Ve(),$=w("\u65E0\u6CD5\u52FE\u9009\uFF0C\u540C\u65F6\u95F4\u5185\u5B58\u5728\u5176\u4ED6\u4F53\u6D4B\u8BA1\u5212"),a=G({id:"",planType:1,address:"",schools:[],planName:"",showLevel:1,booking:!1,scoreStandardType:1,multiDeviceUpload:1,scoreSelectionRule:1,entranceRegistration:2,dateRange:[],cascader:[],classesList:[]}),H=async()=>{const{id:d,address:e,planName:n,planType:o,showLevel:c,classesList:t,multiDeviceUpload:F,scoreStandardType:E,scoreSelectionRule:m,entranceRegistration:f}=a,[p="",i=""]=a.dateRange||[],{succ:g,msg:v}=await Ae({id:d,endTime:i,address:e,planName:n,planType:o,startTime:p,showLevel:c,classesList:t,multiDeviceUpload:F,scoreStandardType:E,scoreSelectionRule:m,entranceRegistration:f});return g||k.error(v),g},P=async()=>{const{address:d,planName:e,planType:n,showLevel:o,classesList:c,scoreStandardType:t,scoreSelectionRule:F,multiDeviceUpload:E,entranceRegistration:m}=a,[f="",p=""]=a.dateRange||[],{succ:i,msg:g}=await we({endTime:p,address:d,planName:e,planType:n,showLevel:o,startTime:f,classesList:c,scoreStandardType:t,multiDeviceUpload:E,scoreSelectionRule:F,entranceRegistration:m});return i||k.error(g),i},S=d=>{const e=[],n=[],{id:o,startTime:c,endTime:t,planSchoolList:F}=d,E=N.value;F==null||F.forEach(m=>{const{schoolCode:f,gradeCode:p,classesCode:i,schoolName:g,classesName:v,gradeName:l}=m;n.push({schoolCode:f,gradeCode:p,classesCode:i,schoolName:g,gradeName:l,classesName:v}),e.push([f,p,i])}),Object.keys(d).forEach(m=>{const f=d[m];m==="cascader"?E.setFields({[m]:{value:e}}):E.setFields({[m]:{value:f}})}),a.id=o,a.cascader=e,a.classesList=n,a.dateRange=[c,t]},q=async()=>{const{succ:d,data:e,msg:n}=await K({planCode:b.value});d?S(e):k.error(n)},I=async()=>{const{succ:d,data:e,msg:n}=await K({planCode:b.value});d?y.value=!!(e!=null&&e.id):k.error(n)},x=async()=>{const{succ:d,data:e,msg:n}=await Re();d?(e==null||e.forEach(o=>{o.isLeaf=!1,o.label=o.name,o.value=o.schoolCode}),a.schools=e||[]):k.error(n)},_=async(d,e)=>{const{succ:n,data:o,msg:c}=await Le({schoolCode:d});n?(o==null||o.forEach(t=>{t.isLeaf=!1,t.label=t.gradeName,t.value=t.gradeCode}),e(o||[])):k.error(c)},V=async(d,e)=>{const{succ:n,data:o,msg:c}=await Te(d);n?(o==null||o.forEach(t=>{t.isLeaf=!0,t.label=t.simpleName,t.value=t.classesCode,t.disabled=t.selected===1}),e(o||[])):k.error(c)},le=()=>{N.value.resetFields(),a.cascader=[],a.classesList=[]},ne=async()=>{b.value?(await I(),y.value?r.replace({name:"Testdetail",query:{planCode:b.value}}):(k.info("\u4F53\u6D4B\u8BA1\u5212\u4E0D\u5B58\u5728\uFF0C\u5373\u5C06\u8DF3\u8F6C\u5230\u4F53\u6D4B\u8BA1\u5212\u5217\u8868\u9875"),r.replace({name:"Testmgmt"}))):r.replace({name:"Testmgmt"})},de=()=>{h(!0),N.value.validate(async e=>{if(e)h(!1);else try{b.value?(await I(),y.value?await H()&&r.replace({name:"Testdetail",query:{planCode:b.value}}):k.info("\u4F53\u6D4B\u8BA1\u5212\u4E0D\u5B58\u5728\uFF0C\u8BF7\u70B9\u51FB\u8FD4\u56DE\u5230\u4F53\u6D4B\u8BA1\u5212\u5217\u8868\u9875")):await P()&&r.replace({name:"Testmgmt"})}finally{h(!1)}})},ce=(d,e)=>{const n=b.value,{id:o,name:c,schoolCode:t,gradeCode:F,gradeName:E}=d;setTimeout(()=>{if(o&&c&&t&&_(t,e),t&&F&&E){const[m="",f=""]=a.dateRange||[];if(!m||!f){k.error("\u8BF7\u5148\u8BBE\u7F6E\u8BA1\u5212\u8D77\u6B62\u65F6\u95F4"),e();return}V(n?{endTime:f,startTime:m,schoolCode:t,gradeCode:F,planCode:n}:{endTime:f,startTime:m,schoolCode:t,gradeCode:F},e)}},100)},ie=d=>{var f;const e=d,n=e.length,o=a.classesList.length,c={};if((f=a.schools)==null||f.forEach(({schoolCode:p,name:i})=>{c[p]=i}),!n){a.classesList=[];return}let t=-1,F=-1;const E=e.map(p=>p[2]),m=a.classesList.map(p=>p.classesCode);if(o>n&&m.some((i,g)=>{const v=!E.includes(i);return v&&(t=g),v})&&a.classesList.splice(t,1),o<n){if(o===0)e.forEach(p=>{const[i,g,v]=p,l=c[i],z={schoolCode:i,schoolName:l,gradeCode:g,classesCode:v};a.classesList.push(z)});else if(E.some((i,g)=>{const v=!m.includes(i);return v&&(F=g),v})){const[i,g,v]=e[F],l=c[i],z={schoolCode:i,schoolName:l,gradeCode:g,classesCode:v};a.classesList.push(z)}}},re=d=>{var n;let e="";return(n=a.classesList)==null||n.some(o=>{const{schoolCode:c,gradeCode:t,classesCode:F,schoolName:E,gradeName:m,classesName:f}=o,[p,i,g]=d;return p===c&&i===t&&g===F?(e=`${E}/${m}/${f}`,!0):!1}),e},me=()=>{a.schools=[],a.cascader=[],a.classesList=[],A.value=Date.now(),x()},pe=()=>{a.schools=[],a.cascader=[],a.classesList=[],A.value=Date.now(),x()};return Z(()=>{x();const{query:{planCode:d}}=r.currentRoute.value;d&&(b.value=d,q())}),(d,e)=>{const n=ue,o=ae,c=Ee,t=ve,F=ee,E=he,m=ge("icon-question-circle-fill"),f=De,p=Ce,i=be,g=se,v=oe;return D(),L("div",Me,[M("div",Ge,[s(g,{ref_key:"formRef",ref:N,model:a,class:"custom-form"},{default:u(()=>[s(o,{field:"planName",label:"\u8BA1\u5212\u540D\u79F0",rules:[{required:!0,match:C(ke).normal1,message:"\u8BA1\u5212\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\u4E14\u53EA\u80FD\u662F\u6570\u5B57\u3001\u4E2D\u6587\u6216\u82F1\u6587"}]},{default:u(()=>[s(n,{modelValue:a.planName,"onUpdate:modelValue":e[0]||(e[0]=l=>a.planName=l),"show-word-limit":"","max-length":15,"allow-clear":"",placeholder:"\u8BF7\u8F93\u5165\u4F53\u6D4B\u8BA1\u5212\u540D\u79F0"},null,8,["modelValue"])]),_:1},8,["rules"]),s(o,{field:"planType",label:"\u8BA1\u5212\u7C7B\u578B",rules:[{required:!0,message:"\u8BA1\u5212\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A"}]},{default:u(()=>[s(t,{modelValue:a.planType,"onUpdate:modelValue":e[1]||(e[1]=l=>a.planType=l)},{default:u(()=>[s(c,{value:C(Ne).\u56FD\u6807\u4F53\u4FA7},{default:u(()=>[je]),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1}),s(o,{field:"dateRange",label:"\u8D77\u6B62\u65F6\u95F4",rules:[{required:!0,message:"\u5B66\u6821\u7C7B\u522B\u4E0D\u80FD\u4E3A\u7A7A"}]},{default:u(()=>[s(F,{modelValue:a.dateRange,"onUpdate:modelValue":e[2]||(e[2]=l=>a.dateRange=l),"disabled-date":l=>C(j)(l).isBefore(C(j)().subtract(1,"day")),onChange:pe},null,8,["modelValue","disabled-date"])]),_:1}),s(o,{field:"booking",disabled:"",label:"\u5F00\u653E\u9884\u7EA6"},{default:u(()=>[s(E,{modelValue:a.booking,"onUpdate:modelValue":e[3]||(e[3]=l=>a.booking=l)},{checked:u(()=>[Ke]),unchecked:u(()=>[Oe]),_:1},8,["modelValue"])]),_:1}),a.booking?(D(),R(o,{key:0},{default:u(()=>[s(ze)]),_:1})):Be("",!0),s(o,{field:"scoreSelectionRule",label:"\u6210\u7EE9\u9009\u53D6\u89C4\u5219"},{default:u(()=>[s(t,{modelValue:a.scoreSelectionRule,"onUpdate:modelValue":e[4]||(e[4]=l=>a.scoreSelectionRule=l)},{default:u(()=>[s(c,{value:C(O).\u6700\u65B0\u6210\u7EE9},{default:u(()=>[Qe]),_:1},8,["value"]),s(c,{value:C(O).\u6700\u597D\u6210\u7EE9},{default:u(()=>[We]),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1}),s(o,{field:"multiDeviceUpload",label:"\u4E0D\u540C\u8BBE\u5907\u4E0A\u4F20\u6210\u7EE9"},{default:u(()=>[s(t,{modelValue:a.multiDeviceUpload,"onUpdate:modelValue":e[5]||(e[5]=l=>a.multiDeviceUpload=l)},{default:u(()=>[s(c,{value:C(Q).\u5141\u8BB8},{default:u(()=>[Je]),_:1},8,["value"]),s(c,{value:C(Q).\u4E0D\u5141\u8BB8},{default:u(()=>[Xe]),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1}),s(o,{field:"address",label:"\u4F53\u6D4B\u5730\u70B9"},{default:u(()=>[s(n,{modelValue:a.address,"onUpdate:modelValue":e[6]||(e[6]=l=>a.address=l),placeholder:"\u8BF7\u8F93\u5165\u4F53\u6D4B\u8BA1\u5212\u5F00\u5C55\u5730\u70B9","show-word-limit":"","max-length":30},null,8,["modelValue"])]),_:1}),s(o,{field:"entranceRegistration",label:"\u68C0\u5F55\u6570\u636E\u4E0A\u4F20"},{default:u(()=>[s(E,{modelValue:a.entranceRegistration,"onUpdate:modelValue":e[7]||(e[7]=l=>a.entranceRegistration=l),"checked-value":C(W).\u5F00,"unchecked-value":C(W).\u5173},{checked:u(()=>[Ye]),unchecked:u(()=>[Ze]),_:1},8,["modelValue","checked-value","unchecked-value"]),s(f,{position:"bl"},{content:u(()=>[ea]),default:u(()=>[s(m,{class:"total-icon"})]),_:1})]),_:1}),s(o,{field:"showLevel",label:"\u6210\u7EE9\u516C\u793A\u663E\u793A\u8BC4\u5206"},{default:u(()=>[s(E,{modelValue:a.showLevel,"onUpdate:modelValue":e[8]||(e[8]=l=>a.showLevel=l),"checked-value":C(J).\u5F00,"unchecked-value":C(J).\u5173},{checked:u(()=>[aa]),unchecked:u(()=>[ua]),_:1},8,["modelValue","checked-value","unchecked-value"])]),_:1}),s(o,{field:"cascader",label:"\u4F53\u6D4B\u5B66\u6821",rules:[{required:!0,message:"\u4F53\u6D4B\u5B66\u6821\u4E0D\u80FD\u4E3A\u7A7A"}]},{default:u(()=>[(D(),R(i,{key:A.value,modelValue:a.cascader,"onUpdate:modelValue":e[9]||(e[9]=l=>a.cascader=l),"load-more":ce,options:a.schools,placeholder:"\u8BF7\u9009\u62E9\u4F53\u6D4B\u5B66\u6821\uFF0C\u5FC5\u9009\u9879","allow-clear":"",multiple:"","path-mode":"","max-tag-count":10,fallback:re,onChange:ie,onClear:me},{option:u(({data:l})=>[l.isLeaf&&l.disabled?(D(),R(p,{key:0,content:$.value},{default:u(()=>[M("span",null,T(l.label),1)]),_:2},1032,["content"])):(D(),L("span",oa,T(l.label),1))]),_:1},8,["modelValue","options"]))]),_:1})]),_:1},8,["model"])]),M("div",sa,[s(v,{class:"mr8",type:"primary",loading:C(U),onClick:de},{default:u(()=>[ta]),_:1},8,["loading"]),s(v,{class:"mr8",onClick:le},{default:u(()=>[la]),_:1}),s(v,{onClick:ne},{default:u(()=>[na]),_:1})])])}}});const wa=X(da,[["__scopeId","data-v-65d75f64"]]);export{wa as default};
